---
layout: post
title: "[C# 筆記] string 和 StringBuilder 的區別，兩者表現的比較"
date: 2017-02-03 23:01:00 +0800
categories: [Notes,C#]
tags: [C#,基礎語法,string,StringBuilder]
---

string 和 StringBuilder 的區別，兩者表現的比較

## 1. 不可變性：

- `string` 是不可變的。
    - string 是 .NET 中表示不可變字串的類型。這意味著一旦創建了一個 string 對象，它的值就不能被修改。如果對其進行操作，將會生成一個新的 string 對象。
    (一旦創建了一個字串對象，就不能更改其內容。對字串進行修改實際上是建立一個新的字串物件。)
    - 因為 string 是不可變的，所以每次對 string 執行操作（例如連接、分割、替換等），都會分配新的內存空間，這可能導致內存碎片化和性能下降。

- `StringBuilder` 是可變的。
    - StringBuilder 是用於處理可變字串的類型，它允許動態修改其內容而不創建新的對象。這對於大量字串操作很有用，因為它避免了不斷創建新的 string 對象，從而提高了性能。
    (它允許對字串進行動態的、原地的修改，而不必每次都建立新的物件。)
    - StringBuilder 類型的對象具有內部緩衝區，用於存儲和修改字串的內容。當進行字串操作時，內容可以在緩衝區內進行修改，而無需分配新的內存空間。

## 2. 性能比較：

- 當需要頻繁地對字串進行修改時，`StringBuilder` 通常比直接使用 `string` 更有效率。這是因為 `StringBuilder` 允許原地修改，而不必每次都創建新的字串對象，從而減少了記憶體開銷。
- 對於簡單的字串拼接，如果只涉及少量操作，效能差異可能並不明顯。但在大量拼接或修改的情況下，StringBuilder 的效能優勢會更為明顯。
- 如果你的字串是不需要修改的，或者只進行少量的操作，那麼使用 `string` 就足夠了。

## 3. 內存分配：

- 在使用 `string` 進行字串拼接時，每次拼接都會建立一個新的字串對象，這可能會導致頻繁的記憶體分配和垃圾回收。(都會分配新的內存空間)
- `StringBuilder` 的內部實作使用可變的字元數組，避免了頻繁的記憶體分配，從而提高了效能。(內容可以在緩衝區內進行修改，而無需分配新的內存空間。)

## 4. 線程安全性：

- string 是不可變的，因此是線程安全的。多個執行緒可以同時讀取一個字串物件而不會造成問題。
- StringBuilder 不是線程安全的。如果多個執行緒同時嘗試修改同一個 StringBuilder 實例，可能會引發競態條件。如果在多執行緒環境中需要對字串進行修改，應該考慮使用 StringBuilder 的同步方法或採取其他執行緒安全的措施。

## 結論

綜上所述，選擇使用 string 還是 StringBuilder 取決於特定的使用場景。如果字串是不變的且不需要頻繁修改，使用 string 是合適的。如果需要頻繁進行字串的拼接或修改，尤其是在循環中，使用 StringBuilder 可以提高效能。

- `string` 字串是不變的且不需要頻繁修改
- `StringBuilder` 需要頻繁進行字串的拼接或修改

        
[C# .NET面试系列一：基础语法](https://cloud.tencent.com/developer/article/2394466)