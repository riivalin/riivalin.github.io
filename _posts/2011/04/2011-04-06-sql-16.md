---
layout: post
title: "[SQL] 檢查資料是否存在 Exists、Not Exists"
date: 2011-04-06 05:08:00 +0800
categories: [Notes,SQL]
tags: [子查詢,exists,not exists,select 1]
---

`Exists`效能高，處理速度較快。      

`Exists`通常用來檢查是否有某資料存在，存在為`true`，不存在為`false`。       

基本上， `EXISTS` 是用來測試「內查詢」有沒有產生任何結果。如果有的話，系統就會執行外查詢中的 SQL。若是沒有的話，那整個 SQL 語句就不會產生任何結果。

## Exists

顯示有販賣業績的負責人之負責人ID與負責人姓名

```sql
--顯示有販賣業績的負責人之負責人ID與負責人姓名
select A.負責人ID, A.負責人姓名
from [負責人清單] A
where exists 
(select 1 from [販賣資料] B where B.負責人ID = A.負責人ID)
```

### 執行結果
```
負責人ID	負責人姓名
1	鈴木
2	小野
3	齋藤
5	小林
6	伊藤
7	佐瀨
8	宇賀神
```

## Not Exists

顯示沒有販賣業績的負責人之負責人ID與負責人姓名

```sql
--顯示沒有販賣業績的負責人之負責人ID與負責人姓名
select A.負責人ID, A.負責人姓名
from [負責人清單] A
where not exists 
(select 1 from [販賣資料] B where B.負責人ID = A.負責人ID)
```

### 執行結果

```
負責人ID	負責人姓名
4	藤本
9	岡田
```

## Exists + Except 差集

取得包含於負責人清單，但不包含分店負責人清單中的負責人的總販賣業績(販賣單價*數量)。(差集，可以使用`Except`)

```sql
--取得包含於負責人清單，但不包含分店負責人清單中的負責人的總販賣業績(販賣單價*數量)
select  sum(B.販賣單價*A.數量) "總業績"
from [dbo].[販賣資料] A
join [dbo].[商品清單] B on B.商品ID = A.商品ID
where exists
(
	select [負責人ID] from [dbo].[負責人清單]
	except
	select [分店負責人ID] from [dbo].[分店負責人清單]
)
```

### 執行結果

```
總業績
4625000
```

## Select 1、Select Null

`select 1`、`select unll`一般用來當條件使用，比如：
- `exists(select 1 from table)`
- `exists(select null from table)`
        

[[SQL] Select 1、Select null](https://riivalin.github.io/posts/2011/04/sql-17/)     
[SQL笔记-select 1与select null](https://blog.csdn.net/lewky_liu/article/details/78290971)