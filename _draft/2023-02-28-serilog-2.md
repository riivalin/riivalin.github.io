---
layout: post
title: "[C#] Serilog 初識 (使用Console)"
date: 2023-02-28 00:00:00 +0800
categories: [Notes, NET, C#]
tags: [C#, Log, Serilog]
---

<span style="color: red">使用 Serilog 紀錄 Log (不用設定檔)</span>

1. Serilog 套件安裝
2. 初始化 Serilog
3. 使用 Serilog 記錄日誌
4. 程式結束時調用 Log.CloseAndFlush()

-----

## 安裝 Serilog 套件
使用 NuGet 安裝 Serilog 套件：
- Serilog
- Serilog.Sinks.Console (在指令視窗顯示)
- Serilog.Sinks.File (寫入到檔案)

> 或是 Nuget Package Console 輸入指令：
> ```shell
> Install-Package Serilog
> Install-Package Serilog.Sinks.Console 
> Install-Package Serilog.Sinks.File
> ```

## 初始化 Serilog
以下範例只加入**寫入log檔案**的配置，可再自行配置。
1. 使用 var 宣告物件
```c# 
var log = new LoggerConfiguration()
    .WriteTo.File("log.txt")
    .CreateLogger();
```
2. 使用 Serilog 內建的靜態 Log (Log.Logger)
```c#
Log.Logger = new LoggerConfiguration()
    .WriteTo.File("log.txt")
    .CreateLogger();
```

## 使用 Serilog 記錄 Log
### 1. 最簡單的使用方式

```c#
using Serilog; //引用Serilog

var log = new LoggerConfiguration() //建立Logger物件
    .WriteTo.Console() //Log輸出在控制台上
    .WriteTo.File("log.txt") //Log寫入檔案
    .CreateLogger(); //返回已配置的Logger物件

log.Information("Hello, serilog."); //觸發記錄日誌
```
運行結果：`.WriteTo.File("log.txt")`呈現的 Log 內容為易讀文字： 
``` 
2023-02-28 00:20:54.568 +08:00 [INF] Hello, serilog.
```
### 2. 使用 Serilog 內置的靜態 Log (Log.Logger)

```c#
using Serilog; //引用Serilog

Log.Logger = new LoggerConfiguration() //建立 Logger 物件
    .WriteTo.Console(new CompactJsonFormatter()) //輸出Jsno格式(控制台)
    .WriteTo.File(new CompactJsonFormatter(), //儲存為Json格式(檔案)
        "logs/log-.txt", //log存放位置。logs/log-20230228.txt
        rollingInterval: RollingInterval.Day) //log檔以日期命名
    .CreateLogger(); //配置後Logger物件賦值靜態Log使用

Log.Information("Hi, serilog."); //觸發記錄Log

Log.CloseAndFlush(); //程式結束前關閉它(很重要!!!)
```

運行結果：有設定 Json 格式`new CompactJsonFormatter()`的 Log 內容： 
```
{"@t":"2023-02-28T07:35:49.0976672Z","@mt":"Hi, serilog."}
```

### 